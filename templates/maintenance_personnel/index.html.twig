{% extends 'base.html.twig' %}

{% block title %} Квалификация обслуживающего персонала {% endblock %}

{% block body %}
    
	<div class="row">
		<a href="{{ path('types_of_wto_index') }}">Первая таблица</a>
	</div>

    <h1>Квалификация обслуживающего персонала</h1>

    <table class="table table-bordered">
        <thead>
            <tr>
                <td rowspan="2">Номер группы</td>
                <td rowspan="2"><a href="{{ path('workers_skill_level_new') }}">Уровень квалификации группы</a></td>
                <td rowspan="2"><a href="{{ path('workers_qualification_coefficients_new') }}">Коэффициент квалификации группы</a></td>
                <td colspan="6"><a href="{{ path('quality_factor_work_performed_new') }}">Коэффициент качества выполненной работы</a></td>
            </tr>
            <tr>
                <td>-2</td>
                <td>-1</td>
                <td>0</td>
                <td>1</td>
                <td>2</td>
                <td>3</td>
            </tr>
        </thead>
        <tbody>
        {% for maintenance_personnel in maintenance_personnels %}
        {% set count_WSL = maintenance_personnel.getRelationWSL().count %}
        {% set count_WQC = maintenance_personnel.getRelationWQC().count %}
        {% set count_QFWP = maintenance_personnel.getRelationQFWP().count %}
            <tr>
                <td rowspan={{count_QFWP}}><a href="{{ path('maintenance_personnel_edit', {'id': maintenance_personnel.id}) }}">{{ maintenance_personnel.id }}</a></td>
                <td rowspan={{count_QFWP}}>
                    {% for WSL in maintenance_personnel.getRelationWSL() %}
                    <p>
                    <a href="{{ path('workers_skill_level_edit', {'id': WSL.id}) }}">{{ WSL.getRelation().typeWTO }} -> {{ WSL.skillLevel }}</a>
                    </p>
                    {% else %}
                        -
                    {% endfor %}
                </td>
                <td rowspan={{count_QFWP}}>
                    {% for WQC in maintenance_personnel.getRelationWQC() %}
                    <p>
                    <a href="{{ path('workers_qualification_coefficients_edit', {'id': WQC.id}) }}">{{ WQC.getRelation().aggregateWTO }} -> {{ WQC.qualificationCoefficient }}</a>
                    </p>
                    {% else %}
                        -
                    {% endfor %}
                </td>
                {% set counter = 0 %}
                {% for QFWP in maintenance_personnel.getRelationQFWP() %}
                    {% if ( counter > 0 ) %}
                        <tr>
                            <td>
                            <p>
                            <a href="{{ path('quality_factor_work_performed_edit', {'id': QFWP.id}) }}">{{ QFWP.getRelation().aggregateWTO }} -> </a>{{ QFWP.qualityFactor }}
                            </p>
                            </td>
                            <td>
                            {{ QFWP.qualityFactor1 }}
                            </td>
                            <td>
                            {{ QFWP.qualityFactor2 }}
                            </td>
                            <td>
                            {{ QFWP.qualityFactor3 }}
                            </td>
                            <td>
                            {{ QFWP.qualityFactor4 }}
                            </td>
                            <td>
                            {{ QFWP.qualityFactor5 }}
                            </td>
                        </tr>
                    {% else %}
                        <td>
                        <p>
                        <a href="{{ path('quality_factor_work_performed_edit', {'id': QFWP.id}) }}">{{ QFWP.getRelation().aggregateWTO }} -> </a>{{ QFWP.qualityFactor }}
                        </p>
                        </td>
                        <td>
                        {{ QFWP.qualityFactor1 }}
                        </td>
                        <td>
                        {{ QFWP.qualityFactor2 }}
                        </td>
                        <td>
                        {{ QFWP.qualityFactor3 }}
                        </td>
                        <td>
                        {{ QFWP.qualityFactor4 }}
                        </td>
                        <td>
                        {{ QFWP.qualityFactor5 }}
                        </td>
                    {% endif %}
                    {% set counter = counter + 1 %}
                {% endfor %}
            </tr>
        {% else %}
            <tr>
                <td colspan="8">Нет данных</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    {{ include('maintenance_personnel/_form.html.twig') }}
    <p> Матрица качества выполнения видов работ для каждого агрегата</p>

    <table class="table table-bordered">
        <thead>
            <tr>
                <td>Аггрегаты</td>
                <td>-2</td>
                <td>-1</td>
                <td>0</td>
                <td>1</td>
                <td>2</td>
                <td>3</td>
                <td>Количество выполненных работ</td>
            </tr>
        </thead>
        <tbody>
                {% for aggregate_wto in aggregates_wtos %}
                <tr>
                    {% if (aggregate_wto.qualityFactorWorkPerformeds().Count != 0) %}
                        <td>
							{{ aggregate_wto.aggregateWTO }}
                        </td>
					{% endif %}
                    {% if (aggregate_wto.qualityFactorWorkPerformeds().count > 0) %}
                        {% set qualityFactor = 0 %}
                        {% set qualityFactor1 = 0 %}
                        {% set qualityFactor2 = 0 %}
                        {% set qualityFactor3 = 0 %}
                        {% set qualityFactor4 = 0 %}
                        {% set qualityFactor5 = 0 %}
                        {% for qFWP in aggregate_wto.qualityFactorWorkPerformeds() %}
                            {% set qualityFactor = qualityFactor + qFWP.getQualityFactor() %}
                            {% set qualityFactor1 = qualityFactor1 + qFWP.getQualityFactor1() %}
                            {% set qualityFactor2 = qualityFactor2 + qFWP.getQualityFactor2() %}
                            {% set qualityFactor3 = qualityFactor3 + qFWP.getQualityFactor3() %}
                            {% set qualityFactor4 = qualityFactor4 + qFWP.getQualityFactor4() %}
                            {% set qualityFactor5 = qualityFactor5 + qFWP.getQualityFactor5() %}
                        {% endfor %}
                            <td>
                                {{ qualityFactor}}
                            </td>
                            <td>
                                {{ qualityFactor1}}
                            </td>
                            <td>
                                {{ qualityFactor2}}
                            </td>
                            <td>
                                {{ qualityFactor3}}
                            </td>
                            <td>
                                {{ qualityFactor4}}
                            </td>
                            <td>
                                {{ qualityFactor5}}
                            </td>
                            <td>
                                {{ qualityFactor + qualityFactor1 + qualityFactor2 + qualityFactor3 + qualityFactor4 + qualityFactor5 }}
                            </td>
                    {% endif %}
                    </tr>
                {% else %}
                    <tr>
                    <td colspan="2">Нет данных</td>
                    </tr>
                {% endfor %}
            
        </tbody>
    </table>

    
{% endblock %}
